---
title: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§kubernetesã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¾ã§ã‚µãƒƒã‚¯ãƒªè©¦ã™ã€minikubeã€‘
tags:
  - kubernetes
  - minikube
private: false
updated_at: '2024-04-29T20:43:24+09:00'
id: 77bd8dfbaba10026905b
organization_url_name: null
slide: false
ignorePublish: false
---
# ã¯ã˜ã‚ã«
ã€Œkubernetesã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã§æ¤œè¨¼ã§ããªããªã„ã£ã™ã‹ï¼Ÿã€ã¨å…ˆç”Ÿã«èã„ãŸã‚‰
ã“ã‚“ãªã‚“ã‚ã‚‹ã§ã¨minikubeã‚’æ•™ãˆã¦ã„ãŸã ã„ãŸã®ã§ä½¿ã£ã¦è¦‹ãŸã„ã¨æ€ã„ã¾ã™ã€‚
k8sã¨ã„ã£ãŸã‚‰ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã ã¨å‹æ‰‹ã«æ€ã£ã¦ã„ã‚‹ã®ã§ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’ç¢ºèªã§ãã‚‹ã¾ã§ã‚’æ›¸ãã¾ã™ã€‚
ç´°ã‹ã„ç”¨èªã‚’æ›¸ã„ã¦ã„ãã¨é•·å¤§ã«ãªã‚Šãã†ãªã®ã§ã€ãƒãƒ³ã‚ºã‚ªãƒ³çš„ã«ã‚³ãƒ”ãƒšã§è©¦ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

https://minikube.sigs.k8s.io/docs/

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦applyã—ã¦ã„ãå½¢ã§é€²è¡Œã—ã¾ã™ã€‚

# å¯¾è±¡
1. k8sã‚’æ¥­å‹™ã§ä½¿ã£ã¦ã„ã‚‹ã‘ã©ã€ã‚ˆãã‚ã‹ã£ã¦ã„ãªã„ã®ã§ã‚³ãƒãƒ³ãƒ‰å©ãã®ãŒæã„äºº
1. Dockerã®åŸºæœ¬çš„ãªã“ã¨ã¯ç†è§£ã—ã¦ã„ã‚‹ï¼ˆDockerfileã‚’è¨˜è¿°ã§ãã‚‹ãã‚‰ã„ï¼‰


# ç’°å¢ƒ
macOS Sonoma
**DockerãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨**
ã‚¹ãƒšãƒƒã‚¯ã®è¦ä»¶ãŒã‚ã‚‹ã®ã§æ³¨æ„ã§ã™ã€‚

:::note info
2CPUä»¥ä¸Š
2GBã®ç©ºããƒ¡ãƒ¢ãƒª
20GBã®ç©ºããƒ‡ã‚£ã‚¹ã‚¯å®¹é‡
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š
ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¾ãŸã¯ä»®æƒ³ãƒã‚·ãƒ³ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (ä¾‹: Dockerã€QEMUã€Hyperkitã€Hyper-Vã€KVMã€Parallelsã€Podmanã€VirtualBoxã€ã¾ãŸã¯VMware Fusion/Workstation)
:::

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
minikubeè‡ªä½“ã¯brewã§å…¥ã‚Œã‚‹ã®ãŒæ¥½ã§ã™ã€‚
```minikube start``` ã¯ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ä½œæˆã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ãŒã€ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒå…¥ã£ã¦ã„ãªã„å ´åˆã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å…¥ã‚Œã¦ãã‚Œã¾ã™ã€‚

```zsh
$ brew install minikube
$ minikube start
```

wslã§è©¦ã—ã¦ã„ã‚‹ã¨ãã¯ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§kuberctlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã§ã—ãŸã®ã§ã€ç’°å¢ƒã«ã‚ˆã£ã¦ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚

https://kubernetes.io/docs/tasks/tools/

# podã®ä½œæˆ
kubernetes-bootcampã¨ã„ã†ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã„ã¾ã™ã€‚

https://kubernetesbootcamp.github.io/kubernetes-bootcamp/index.html

Deploymentã™ã‚‹ãŸã‚ã®yamlã‚’ç”¨æ„ã—ã¾ã™ã€‚

```zsh
echo 'apiVersion: apps/v1
kind: Deployment
metadata:
  name: kubernetes-bootcamp
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kubernetes-bootcamp
  template:
    metadata:
      labels:
        app: kubernetes-bootcamp
    spec:
      containers:
      - name: kubernetes-bootcamp
        image: gcr.io/google-samples/kubernetes-bootcamp:v1
        ports:
        - containerPort: 8080' > deployment.yaml
```

yamlã‹ã‚‰podã‚’ä½œã‚Šã¾ã™ã€‚
èµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã®ã§ã—ã°ã‚‰ãå¾…ã¡ã¾ã™ã€‚

```zsh
$ kubectl apply -f deployment.yaml
$ kubectl get pods
NAME                                  READY   STATUS              RESTARTS   AGE
kubernetes-bootcamp-978dd9cbc-k9n9h   1/1     ContainerCreating   0          17s
```
# Serviceã®ä½œæˆ
podã ã‘ã‚ã£ã¦ã‚‚å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
Serviceã‚’ä½œã£ã¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å¤–éƒ¨ã«å…¬é–‹ã—ã¦ã‚ã’ã¾ã™ã€‚

```zsh
echo 'apiVersion: v1
kind: Service
metadata:
  name: kubernetes-bootcamp
spec:
  type: NodePort
  ports:
  - port: 8080
    targetPort: 8080
    nodePort: 9000  # ä»»æ„ã®Port
  selector:
    app: kubernetes-bootcamp' > service.yaml
```

```zsh
$ kubectl get services
NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
kubernetes            ClusterIP   10.96.0.1       <none>        443/TCP          33m
kubernetes-bootcamp   NodePort    10.110.164.47   <none>        8080:9000/TCP   15m
```

ServiceãŒä½œæˆã§ãã¾ã—ãŸã€‚
å®Ÿè¡Œã—ã¦æŒ‡ç¤ºã•ã‚Œã¦ã„ã‚‹URLã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚

```zsh
$ minikube service kubernetes-bootcamp
|-----------|---------------------|-------------|---------------------------|
| NAMESPACE |        NAME         | TARGET PORT |            URL            |
|-----------|---------------------|-------------|---------------------------|
| default   | kubernetes-bootcamp |        8080 | http://192.168.64.3:9000 |
|-----------|---------------------|-------------|---------------------------|
ğŸ‰  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ default/kubernetes-bootcamp ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ã„ã¦ã„ã¾ã™...
```

```zsh
$ curl http://192.168.64.3:9000/
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-978dd9cbc-k9n9h | v=1
```

# ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹
å…ˆã»ã©ä½œæˆã—ãŸdeployment.yamlã®replicasã‚’ï¼’ä»¥ä¸Šã®ä»»æ„ã®å€¤ã«ã—ã¾ã™ã€‚
**å¢—ã‚„ã—ã™ãã‚‹ã¨å¤šå¤§ãªè² è·ãŒã‹ã‹ã‚‹ã¨æ€ã†ã®ã§ã»ã©ã»ã©ã«**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kubernetes-bootcamp
spec:
  replicas: 3 # ã“ã“ã‚’ä»»æ„ã®å€¤ã«ã™ã‚‹
  selector:
    matchLabels:
      app: kubernetes-bootcamp
  template:
    metadata:
      labels:
        app: kubernetes-bootcamp
    spec:
      containers:
      - name: kubernetes-bootcamp
        image: gcr.io/google-samples/kubernetes-bootcamp:v1
        ports:
        - containerPort: 8080
```

ã‚‚ã†ä¸€åº¦applyã—ã¦podãŒå¢—ãˆã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```zsh
$ kubectl apply -f deployment.yaml
deployment.apps/kubernetes-bootcamp configured
$ kubectl get pods
NAME                                  READY   STATUS    RESTARTS   AGE
kubernetes-bootcamp-978dd9cbc-64wzc   1/1     Running   0          2s
kubernetes-bootcamp-978dd9cbc-hznfd   1/1     Running   0          2s
kubernetes-bootcamp-978dd9cbc-rtdjs   1/1     Running   0          26s
```

å¢—ãˆã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ããŸã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```zsh
$ curl http://192.168.64.3:9000/
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-978dd9cbc-hznfd | v=1
$ curl http://192.168.64.3:9000/
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-978dd9cbc-64wzc | v=1
$ curl http://192.168.64.3:9000/
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-978dd9cbc-rtdjs | v=1
```

éƒ½åº¦ä½¿ç”¨ã•ã‚Œã‚‹podãŒå¤‰ã‚ã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã­ã€‚
ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŒã§ãã¦ã„ã¾ã™ã€‚

çµ‚ã‚ã£ãŸã‚‰ã‚¯ãƒ©ã‚¹ã‚¿ã‚’å‰Šé™¤ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚
```zsh
minikube delete --all
```

# ãã®ä»–
## podãŒç«‹ã¡ä¸ŠãŒã‚‰ãªã„
podãŒrunningçŠ¶æ…‹ã«ãªã‚‹ã¾ã§æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚
ã—ã‹ã—ã€ã‚ã¾ã‚Šã«ã‚‚èµ·å‹•ã—ãªã‹ã£ãŸã‚‰yamlãŒé–“é•ãˆã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§å®Ÿè¡Œæ™‚ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¾ã™ã€‚

```zsh
$ kubectl describe pod {get podsã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹podå}
```
ã“ã¡ã‚‰ã§è¡¨ç¤ºã•ã‚Œã‚‹Eventsã‚¿ã‚°ãŒå®Ÿè¡Œæ™‚ã®ãƒ­ã‚°ã§ã™ã€‚
æœ€åˆnginxã®ã‚³ãƒ³ãƒ†ãƒŠã§è©¦ã—ã¦ã„ãŸã®ã§ã™ãŒã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ãŸã›ã„ã§èµ·å‹•ã—ã¾ã›ã‚“ã§ã—ãŸã€‚
ãã®éš›ã“ã“ã«Docker Hubã‹ã‚‰pullã§ããªã‹ã£ãŸæ—¨ã®ã‚¨ãƒ©ãƒ¼ãŒåã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚

## port-forwardã ã¨ä¸€ã¤ã®podã—ã‹ä½¿ã‚ã‚Œãªã„
å¤–éƒ¨ã«ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¬é–‹ã™ã‚‹ã¨ãä»¥ä¸‹ã®ã‚ˆã†ã«port-forwardã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å…¬é–‹ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```zsh
$ kubectl port-forward service/kubernetes-bootcamp 9000:8080
```

ã—ã‹ã—ã“ã®æ–¹æ³•ã ã¨ä¸€ã¤ã®podã—ã‹ä½¿ã‚ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚
ã“ã¡ã‚‰ã§å…¬é–‹ã™ã‚‹ã¨podãŒå›ºå®šåŒ–ã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

https://mome-n.com/posts/minikube-service-fixed-port/#kubectlã®port-forwardã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹

```get pods```ã‚³ãƒãƒ³ãƒ‰ã«```-o wide```ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã‚‹IPãŒè¦‹ã‚Œã‚‹ã®ã§ã™ãŒã€ã“ã®IPã«å›ºå®šã•ã‚Œã¦ã„ã‚‹ã®ã ã¨æ€ã„ã¾ã™ã€‚ï¼ˆæœ¬å½“ã«ãŸã ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹ã ã‘ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰

```zsh
$ kubectl get pods -o wide
NAME                                  READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES
kubernetes-bootcamp-978dd9cbc-6cbxd   1/1     Running   0          2m21s   10.244.0.5   minikube   <none>           <none>
kubernetes-bootcamp-978dd9cbc-7vp7w   1/1     Running   0          2m21s   10.244.0.4   minikube   <none>           <none>
kubernetes-bootcamp-978dd9cbc-x6chk   1/1     Running   0          2m21s   10.244.0.3   minikube   <none>           <none>
```

## å‚è€ƒ
https://zenn.dev/cozy07/articles/b7ba77bb766783

https://zenn.dev/sakana1115/scraps/34917d4a56f6e9
